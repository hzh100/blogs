<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实现方案选型 | blog</title>
    <meta name="description" content="vue、js、nodejs等等的学习记录">
    <link rel="stylesheet" href="/assets/style.49eed234.css">
    <link rel="modulepreload" href="/assets/Home.ae65bc00.js">
    <link rel="modulepreload" href="/assets/app.d95e124d.js">
    <link rel="modulepreload" href="/assets/microFrontend_拟定微前端架构设计.md.fccf143e.lean.js">
    
    <meta name="twitter:title" content="实现方案选型 | blog">
  <meta property="og:title" content="实现方案选型 | blog">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="blog, back to home" data-v-675d8756 data-v-cc01ef16><!----> blog</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://gitee.com/hzh100" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>gitee <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://gitee.com/hzh100" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>gitee <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item"> 介绍</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/">介绍</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">http</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/http/http2">http2</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/http/http3">http3</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/http/http缓存">http缓存</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">innermanage</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/innermanage/内管前端工程">内管前端工程</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">interview</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/JS基础">JS基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/TODO">TODO</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/前端面试之道">前端面试之道</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/各种题目01">各种题目01</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-callbind">手写系列-callbind</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-instanceof">手写系列-instanceof</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-map和filter和reduce">手写系列-map和filter和reduce</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-new原理">手写系列-new原理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-setTime模拟setInterval">手写系列-setTime模拟setInterval</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-发布订阅和观察者">手写系列-发布订阅和观察者</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-复杂axios">手写系列-复杂axios</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-复杂promise">手写系列-复杂promise</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-数组转树">手写系列-数组转树</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-深拷贝">手写系列-深拷贝</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/手写系列-防抖节流">手写系列-防抖节流</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/interview/算法01">算法01</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">jiagou</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/jiagou/monorepo">monorepo</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/jiagou/从0到1构建符合标准的公共库">从0到1构建符合标准的公共库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/jiagou/切换主题方案">切换主题方案</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/jiagou/前端基础建设与架构30讲">前端基础建设与架构30讲</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/jiagou/搭建组件库">搭建组件库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/jiagou/深入babel">深入babel</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/jiagou/自动生成按需导出目录">自动生成按需导出目录</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/jiagou/表单组件带校验功能">表单组件带校验功能</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">js</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/js/class和构造函数">class和构造函数</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/dayFormat正则的使用">dayFormat正则的使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/luhn算法">luhn算法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Object.entries">Object.entries</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/proxy">proxy</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/优雅的Class">优雅的Class</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/前端模块化">前端模块化</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/浏览器垃圾回收">浏览器垃圾回收</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/深入babel">深入babel</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/闭包与垃圾回收">闭包与垃圾回收</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">microFrontend</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/microFrontend/介绍">介绍</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/microFrontend/拟定微前端架构设计">拟定微前端架构设计</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#实现方案选型">实现方案选型</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#iframe">iframe</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#web-component">web component</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自研框架-从0写">自研框架(从0写)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自研微前端架构">自研微前端架构</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#技术栈">技术栈</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#工具库">工具库</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#部署">部署</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#主应用引用子应用的方式">主应用引用子应用的方式</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#js">js</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#html">html</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#生命周期">生命周期</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#样式隔离">样式隔离</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#shadowdom">shadowDom</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#css-module-bem">CSS Module/BEM?</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#动态样式表-dynamic-stylesheet">动态样式表 Dynamic Stylesheet</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#js隔离">js隔离</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#js沙箱">js沙箱</a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/microFrontend/架构思想">架构思想</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">node</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/node/cheetah-learn">cheetah-learn</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/node/cli相关学习">cli相关学习</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">performance</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/performance/serviceWorker">serviceWorker</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/performance/ssr">ssr</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/performance/慕课网web性能优化">慕课网web性能优化</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">typescript</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/typescript/vue2加ts">vue2加ts</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">vue</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/create-vue脚手架">create-vue脚手架</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/esbuild使用">esbuild使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/keep-alive原理">keep-alive原理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/vue-router实现原理">vue-router实现原理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/模板编译">模板编译</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/路由页面历史栈的处理">路由页面历史栈的处理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-01模板语法">重学vue-01模板语法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-02数据驱动视图">重学vue-02数据驱动视图</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-03render函数">重学vue-03render函数</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-04内置指令">重学vue-04内置指令</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-05filter多余吗">重学vue-05filter多余吗</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-06computer">重学vue-06computer</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-07watch">重学vue-07watch</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-08组件">重学vue-08组件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-09生命周期">重学vue-09生命周期</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-10ref是什么">重学vue-10ref是什么</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-11nextTick">重学vue-11nextTick</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-8组件通信">重学vue-8组件通信</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-vue.use">重学vue-vue.use</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/重学vue-动画内置组件">重学vue-动画内置组件</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">vue3</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue3/elementPlus">elementPlus</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue3/入门">入门</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">webComponents</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/webComponents/1. webComponent介绍">1. webComponent介绍</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/webComponents/2. customElements">2. customElements</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">webpack</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/webpack/1">1</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/webpack/实现一个自己的脚手架">实现一个自己的脚手架</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/webpack/重学webpack-01打包工具的思考">重学webpack-01打包工具的思考</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/webpack/重学webpack-02模块化原理">重学webpack-02模块化原理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/webpack/重学webpack-03loader">重学webpack-03loader</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/webpack/重学webpack-04plugin">重学webpack-04plugin</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/webpack/重学webpack-05HMR热更新">重学webpack-05HMR热更新</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">week</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/week/202110-1">202110-1</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/week/202110-2">202110-2</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/week/202111-1">202111-1</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/week/缓存工具方法思路">缓存工具方法思路</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">work</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/work/ios小白条问题">ios小白条问题</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h2 id="实现方案选型" tabindex="-1">实现方案选型 <a class="header-anchor" href="#实现方案选型" aria-hidden="true">#</a></h2><h3 id="iframe" tabindex="-1">iframe <a class="header-anchor" href="#iframe" aria-hidden="true">#</a></h3><p>优点</p><ul><li>技术成熟(兼容性好)</li><li>使用简单(直接一个src的url接入)</li><li>天然支持沙箱隔离、独立运行</li><li>现成的通信api(postmessage)</li></ul><p>缺点</p><ul><li>加载、渲染、缓存由浏览器决定，性能不好且不可定制</li><li>资源重复从头加载(多页面应用)</li></ul><h3 id="web-component" tabindex="-1">web component <a class="header-anchor" href="#web-component" aria-hidden="true">#</a></h3><p>TODO: 是什么，怎么做成微前端</p><p>优点</p><ul><li>利用shadow dom，关联进行控制</li><li>支持slot、template插槽</li></ul><p>缺点</p><ul><li>接入的子应用需要打包成web component</li><li>生态不完善，技术过新</li><li>兼容性不好</li></ul><h3 id="自研框架-从0写" tabindex="-1">自研框架(从0写) <a class="header-anchor" href="#自研框架-从0写" aria-hidden="true">#</a></h3><p>优点</p><ul><li>高度定制化，按需设计</li><li>通信和沙箱隔离</li><li>不从头刷新页面来加载</li></ul><p>缺点</p><ul><li>技术实现难，自己实现通信、沙箱隔离等</li><li>首次加载资源过大</li></ul><h2 id="自研微前端架构" tabindex="-1">自研微前端架构 <a class="header-anchor" href="#自研微前端架构" aria-hidden="true">#</a></h2><ul><li>路由分发</li><li>子应用共享依赖资源</li><li>子应用接入主应用后，改动小就可以相互通信</li></ul><p>整体系统架构图</p><h3 id="技术栈" tabindex="-1">技术栈 <a class="header-anchor" href="#技术栈" aria-hidden="true">#</a></h3><p>前端</p><ul><li>主应用vue3</li><li>子应用vue2 vue3 react15 react16</li></ul><p>后端</p><ul><li>koa</li></ul><p>前端各应用静态服务器自动部署</p><ul><li>express</li></ul><h3 id="工具库" tabindex="-1">工具库 <a class="header-anchor" href="#工具库" aria-hidden="true">#</a></h3><p>路由匹配机制 接入子应用机制 各自生命周期 应用通信机制 沙箱隔离 全局状态管理 共享依赖</p><p>iframe通信</p><ul><li>BroadcastChannel</li></ul><blockquote><p>BroadcastChannel 能够用于同源不同页面之间完成通信的功能。它与 window.postMessage 的区别就是，BroadcastChannel 只能用于同源的页面之间进行通信，而 window.postMessage 却可以用于任何的页面之间；BroadcastChannel 可以认为是 window.postMessage 的一个实例，它承担了 window.postMessage 的一个方面的功能。</p></blockquote><div class="language-js"><pre><code><span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastChannel</span><span class="token punctuation">(</span><span class="token string">&#39;channel-name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

channel<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&#39;some message&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;value&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

channel<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>SharedWorker API</li></ul><blockquote><p>Shared Worker 类似于 Web Workers，不过其会被来自同源的不同浏览上下文间共享，因此也可以用作消息的中转站。使用方式和作用可以类比<code>localstore</code></p></blockquote><div class="language-js"><pre><code><span class="token comment">// main.js</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&#39;shared-worker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&#39;some message&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// shared-worker.js</span>
<span class="token keyword">const</span> connections <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function-variable function">onconnect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> e<span class="token punctuation">.</span>ports<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  connections<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  connections<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">connection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!==</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      connection<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Local Storage</li></ul><blockquote><p>localStorage 是常见的持久化同源存储机制，其会在内容变化时触发事件，也就可以用作同源界面的数据通信。</p></blockquote><div class="language-js"><pre><code>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;key&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;value&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function-variable function">onstorage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> e<span class="token punctuation">.</span>newValue<span class="token punctuation">;</span> <span class="token comment">// previous value at e.oldValue</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Web Components &amp;&amp; Shadow DOM 兼容性不好，移动端一般敢直接用，而是编译成js资源包</p><p>Web Components 的目标是减少单页应用中隔离 HTML，CSS 与 JavaScript 的复杂度</p><ul><li>Custom Elements,</li><li>Shadow DOM</li><li>Template Element</li><li>HTML Imports</li><li>Custom Properties</li></ul><p>Shadow DOM 它允许在文档（document）渲染时插入一棵 DOM 元素子树，但是这棵子树不在主 DOM 树中</p><p>用纯html和js创建shadowDom</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostElement<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token comment">// 创建 shadow DOM</span>
      <span class="token keyword">var</span> shadow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#hostElement&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;open&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 给 shadow DOM 添加文字</span>
      shadow<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;&lt;p&gt;Here is some new text&lt;/p&gt;&#39;</span><span class="token punctuation">;</span>
      <span class="token comment">// 添加CSS，将文字变红</span>
      shadow<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token string">&#39;&lt;style&gt;p { color: red; }&lt;/style&gt;&#39;</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>用react创建shadowDom</p><div class="language-js"><pre><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> retargetEvents <span class="token keyword">from</span> <span class="token string">&#39;react-shadow-dom-retarget-events&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;I have been clicked&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Click me<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> proto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">HTMLElement</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">attachedCallback</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> mountPoint <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;span&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> shadowRoot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createShadowRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      shadowRoot<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mountPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> mountPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">retargetEvents</span><span class="token punctuation">(</span>shadowRoot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这是注册自定义标签，不是插入dom，实际插入还是要在html或jsk中写</span>
document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">&#39;my-custom-element&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">prototype</span><span class="token operator">:</span> proto <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="部署" tabindex="-1">部署 <a class="header-anchor" href="#部署" aria-hidden="true">#</a></h2><p>上线后的前端项目 以免混淆，以后打包工具的编译时称作构建时building</p><p>现代前端框架上线后的前端项目都是依靠构建时打包成一个体系的前端文件 好处是，较好地依赖管理，抽取公共模块，减少最终的包体大小，不过其最终的产出仍是单体应用，各个应用模块无法进行独立部署</p><p>另一种方式是：运行时runtime组合 服务端整合(SSI)：Tailor 客户端整合：JSPM、SystemJS</p><p>运行时组合同时能提供按需加载的特性，优化首页的加载速度 不过运行时组合可能重复加载依赖项（通过浏览器缓存或 HTTP2 适度解决 最好是单例形式，否则容易污染</p><p>React 这样的声明式组件框架，天然就支持应用的组合，我们可以传入渲染锚点以进行应用组合，也可以将不同框架的应用封装为 Web Components。首先我们可以将 React 应用定义为自定义元素：</p><div class="language-js"><pre><code>window<span class="token punctuation">.</span>customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
  <span class="token string">&#39;react-app&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">class</span> <span class="token class-name">ReactApp</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App title<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后在前端中直接使用该自定义元素：</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>react-app</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>React Separate Running App<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>子应用部署层js包，在主应用根据路由加载，子应用部署，主应用加载就能拿到新的</p><h2 id="主应用引用子应用的方式" tabindex="-1">主应用引用子应用的方式 <a class="header-anchor" href="#主应用引用子应用的方式" aria-hidden="true">#</a></h2><h3 id="js" tabindex="-1">js <a class="header-anchor" href="#js" aria-hidden="true">#</a></h3><p>子应用提供一个entry.js，由主应用加载 通常是子应用将资源打成一个 entry script，比如 single-spa。但这个方案的限制也颇多，如要求子应用的所有资源打包到一个 js bundle 里，包括 css、图片等资源。除了打出来的包可能体积庞大之外的问题之外，资源的并行加载等特性也无法利用上。</p><div class="language-js"><pre><code><span class="token comment">// 主应用 路由配置加载方法</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> singleSpa <span class="token keyword">from</span> <span class="token string">&#39;single-spa&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// import() 异步加载资源</span>
singleSpa<span class="token punctuation">.</span><span class="token function">registerApplication</span><span class="token punctuation">(</span><span class="token string">&#39;app-1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">&#39;../app1/app1.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pathPrefix</span><span class="token punctuation">(</span><span class="token string">&#39;/app1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
singleSpa<span class="token punctuation">.</span><span class="token function">registerApplication</span><span class="token punctuation">(</span><span class="token string">&#39;app-2&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">&#39;../app2/app2.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pathPrefix</span><span class="token punctuation">(</span><span class="token string">&#39;/app2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

singleSpa<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">pathPrefix</span><span class="token punctuation">(</span><span class="token parameter">prefix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>子应用前端框架(entry.js)需要指定节点进行渲染，主应用就要提前写上这个节点。意味着介入一个新的子应用就需要重新部署主应用</p><h3 id="html" tabindex="-1">html <a class="header-anchor" href="#html" aria-hidden="true">#</a></h3><p>直接将子应用打包出来 HTML 作为入口，主框架可以通过 fetch html 的方式获取子应用的静态资源，同时将 HTML document 作为子节点塞到主框架的容器中。这样不仅可以极大的减少主应用的接入成本，子应用的开发方式及打包方式基本上也不需要调整，而且可以天然的解决子应用之间样式隔离的问题</p><p>实际上还是通过js，插入html</p><div class="language-js"><pre><code>framework<span class="token punctuation">.</span><span class="token function">registerApp</span><span class="token punctuation">(</span><span class="token string">&#39;subApp1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//abc.alipay.com/index.html&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>相对于js，会多一次加载html的步骤 js entry，路由配置加载到到入口js(就是一个完整的包)</p><p>html则会路由加载到html，dom插入容器，加载js(完整的包/html加载多个小包)</p><p>当然，这里的html并不是真的作为html使用，而是取出里面的需要挂载实例的节点和资源 <code>&lt;srcipt&gt;</code> 所以也可以不请求一次html，同样用用路由配置</p><div class="language-js"><pre><code>framework<span class="token punctuation">.</span><span class="token function">registerApp</span><span class="token punctuation">(</span><span class="token string">&#39;subApp1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">scripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;//abc.alipay.com/index.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;//abc.alipay.com/index.css&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 这个对象就是html中取出的内容，这样配置，跟js entry其实没有区别，还是要部署主应用，当然可以改成配置中心处理</span>
</code></pre></div><p>配置中心/接口的方式代理部署主应用 其实没省到加载html，所以加载html比起配置，更符合前端的习惯</p><p>比较 <img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20220103160314.png" alt="引入子应用方式比较"></p><h3 id="生命周期" tabindex="-1">生命周期 <a class="header-anchor" href="#生命周期" aria-hidden="true">#</a></h3><p>要使用生命周期，子应用就必须是umd的模式 因为子应用通常又有集成部署、独立部署两种模式同时支持的需求 浏览器中可以使用模块化接收资源事件或变量的方式ESM、UMD</p><p>子应用与主应用约定好一个全局变量，把导出的钩子引用挂载到这个全局变量上，主应用从这里面取生命周期函数 这样需要手动让主子应用的生命周期变量保持一致</p><p>解决办法 所有子应用共用window下的生命周期变量 umd 包格式中的 global export 方式获取子应用的导出一个子应用标识 大体的思路是通过给 window 变量打标记，记住每次最后添加的全局变量，这个变量一般就是应用 export 后挂载到 global 上的变量 实现方式可以参考 <a href="https://github.com/systemjs/systemjs/blob/main/src/extras/global.js" target="_blank" rel="noopener noreferrer">systemjs global import</a>，这里不再赘述。</p><h2 id="样式隔离" tabindex="-1">样式隔离 <a class="header-anchor" href="#样式隔离" aria-hidden="true">#</a></h2><p>子应用之间样式互不影响 针对 &quot;Isolated Styles&quot; 这个问题，如果不考虑浏览器兼容性，通常第一个浮现到我们脑海里的方案会是 Web Components。基于 Web Components 的 Shadow DOM 能力，我们可以将每个子应用包裹到一个 Shadow DOM 中，保证其运行时的样式的绝对隔离。</p><h3 id="shadowdom" tabindex="-1">shadowDom <a class="header-anchor" href="#shadowdom" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">const</span> shadow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#hostElement&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;open&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shadow<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;sub-app&gt;Here is some new text&lt;/sub-app&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;//unpkg.com/antd/antd.min.css&quot;&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>shadow Dom的样式作用域仅在 shadow 元素下</p><p>比如子应用里调用了 antd modal 组件，由于 modal 是挂载到 document.body 的 结果就是modal组件没有样式，因为子应用里才有antd组件的样式，而子应用的容器是shadowDom，所以组件没有样式 解决办法1是把 antd 样式上浮一层，丢到主应用里。。。 解决办法2约定所有子应用不要用挂载到body的组件，而是用主应用提供的api式组件(即子应用调用主应用组件)</p><h3 id="css-module-bem" tabindex="-1">CSS Module/BEM? <a class="header-anchor" href="#css-module-bem" aria-hidden="true">#</a></h3><p>开发写 css 前缀的方式来避免样式冲突，即各个子应用使用特定的前缀来命名 class，或者直接基于 css module 方案写样式。对于一个全新的项目，这样当然是可行，但是通常微前端架构更多的目标是解决存量/遗产 应用的接入问题。很显然遗产应用通常是很难有动力做大幅改造的。</p><p>最主要的是，约定的方式有一个无法解决的问题，假如子应用中使用了三方的组件库，三方库在写入了大量的全局样式的同时又不支持定制化前缀？比如 a 应用引入了 antd 2.x，而 b 应用引入了 antd 3.x，两个版本的 antd 都写入了全局的 .menu class，但又彼此不兼容怎么办？</p><h3 id="动态样式表-dynamic-stylesheet" tabindex="-1">动态样式表 Dynamic Stylesheet <a class="header-anchor" href="#动态样式表-dynamic-stylesheet" aria-hidden="true">#</a></h3><p>解决子应用间的样式污染，那就只允许一个子应用的样式存在</p><p>只需要在应用切出/卸载后，同时卸载掉其样式表即可 原理是浏览器会对所有的样式表的插入/移除，做整个 CSSOM 的重构，从而达到 插入/卸载 样式的目的 即在一个时间点里，只有一个应用的样式表是生效的。</p><p>上文的 HTML Entry 方案则天生具备样式随子应用卸载而移除，因为当子应用被替换或卸载时，subApp 节点的 innerHTML 也会被复写，从而自动移除了其样式表。</p><p>当然，主子应用间的样式冲突，还是要靠css前缀人工约定好</p><h2 id="js隔离" tabindex="-1">js隔离 <a class="header-anchor" href="#js隔离" aria-hidden="true">#</a></h2><p>子应用也是经常需要往window下挂载东西的，如第三方库，子应用级别全局变量 一般还是人为约定全局变量命名带前缀</p><h3 id="js沙箱" tabindex="-1">js沙箱 <a class="header-anchor" href="#js沙箱" aria-hidden="true">#</a></h3><p>每个子应用都会有多个全局变量，这里称为全局变量表</p><p>全局变量表随着子应用卸载而清空，一次只存在一个子应用的全局变量表</p><p>在应用的 bootstrap 及 mount 两个生命周期开始之前分别给全局状态打下快照 加载子应用前的全局变量表(纯主应用的全局变量)，被记录下来。 在子应用挂载自己的全局变量表之后，卸载的时候，恢复到之前的全局变量，并缓存该子应用的全局变量表，下一次可以恢复</p><p>当应用切出/卸载时，将状态回滚至 bootstrap 开始之前的阶段，确保应用对全局状态的污染全部清零 而当应用二次进入时则再恢复至 mount 前的状态的，从而确保应用在 remount 时拥有跟第一次 mount 时一致的全局上下文</p><p>当然沙箱里做的事情还远不止这些，其他的还包括</p><ul><li>对全局事件监听的劫持，确保应用在切出之后，对全局事件的监听能得到完整的卸载</li><li>同时也会在 remount 时重新监听这些全局事件，从而模拟出与应用独立运行时一致的沙箱环境</li></ul><p>不考虑子应用中的组件查到主应用中 即 完全隔离的子应用 <a href="https://micro-zoe.github.io/micro-app/docs.html#/" target="_blank" rel="noopener noreferrer">web components（shadow dom）做微前端</a><a href="https://segmentfault.com/a/1190000040456726" target="_blank" rel="noopener noreferrer">micro-app微前端原理讲解</a> 早期微前端<a href="https://micro-zoe.github.io/micro-app/docs.html#/" target="_blank" rel="noopener noreferrer">single-spa</a></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/microFrontend/介绍" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>介绍</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/microFrontend/架构思想" data-v-38ede35f><span class="text" data-v-38ede35f>架构思想</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"http_http2.md\":\"f913a313\",\"http_http3.md\":\"060f1a93\",\"http_http缓存.md\":\"31fc5d76\",\"index.md\":\"e233a088\",\"innermanage_内管前端工程.md\":\"e613f30e\",\"interview_js基础.md\":\"f3bc5865\",\"interview_todo.md\":\"199537bf\",\"interview__过.md\":\"865ff21e\",\"interview_前端面试之道.md\":\"ec1a40c2\",\"interview_各种题目01.md\":\"079c680b\",\"interview_手写系列-callbind.md\":\"12930746\",\"interview_手写系列-instanceof.md\":\"5ef6c309\",\"interview_手写系列-map和filter和reduce.md\":\"7d9d2352\",\"interview_手写系列-new原理.md\":\"a96cf990\",\"interview_手写系列-settime模拟setinterval.md\":\"e387ac1a\",\"interview_手写系列-发布订阅和观察者.md\":\"a516d630\",\"interview_手写系列-复杂axios.md\":\"ed7137b3\",\"interview_手写系列-复杂promise.md\":\"4e5735bb\",\"interview_手写系列-数组转树.md\":\"c01229aa\",\"interview_手写系列-深拷贝.md\":\"79f771f4\",\"interview_手写系列-防抖节流.md\":\"060f760c\",\"interview_算法01.md\":\"182a4137\",\"jiagou_monorepo.md\":\"51eb3439\",\"jiagou_从0到1构建符合标准的公共库.md\":\"99849ee2\",\"jiagou_切换主题方案.md\":\"501a1a5e\",\"jiagou_前端基础建设与架构30讲.md\":\"f7baf6ec\",\"jiagou_搭建组件库.md\":\"d9bc651d\",\"jiagou_深入babel.md\":\"9abe1423\",\"jiagou_自动生成按需导出目录.md\":\"5f601077\",\"jiagou_表单组件带校验功能.md\":\"d794d549\",\"js_object.entries.md\":\"3ba00128\",\"js_class和构造函数.md\":\"d5c78ad6\",\"js_dayformat正则的使用.md\":\"8abaaa7f\",\"js_luhn算法.md\":\"ffeffec6\",\"js_proxy.md\":\"a7b2ad3a\",\"js_优雅的class.md\":\"497ed7e9\",\"js_前端模块化.md\":\"ed11c518\",\"js_浏览器垃圾回收.md\":\"b6fa7d93\",\"js_深入babel.md\":\"92842df6\",\"js_闭包与垃圾回收.md\":\"bd9a10f4\",\"microfrontend_介绍.md\":\"9ff9f87d\",\"microfrontend_拟定微前端架构设计.md\":\"fccf143e\",\"microfrontend_架构思想.md\":\"748e5304\",\"node_cheetah-learn.md\":\"95e6fcd1\",\"node_cli相关学习.md\":\"c29bfdd7\",\"performance_serviceworker.md\":\"6f67fcf2\",\"performance_ssr.md\":\"0f412a14\",\"performance_慕课网web性能优化.md\":\"f53c24bc\",\"typescript_vue2加ts.md\":\"9d17aaa6\",\"vue_create-vue脚手架.md\":\"89f2fa24\",\"vue_esbuild使用.md\":\"7977b135\",\"vue_keep-alive原理.md\":\"ef31ebc9\",\"vue_vue-router实现原理.md\":\"6106cd66\",\"vue_模板编译.md\":\"50b03259\",\"vue_路由页面历史栈的处理.md\":\"8b4132c2\",\"vue_重学vue-01模板语法.md\":\"436fc3ef\",\"vue_重学vue-02数据驱动视图.md\":\"d89737de\",\"vue_重学vue-03render函数.md\":\"1cc2f4a1\",\"vue_重学vue-04内置指令.md\":\"59840a53\",\"vue_重学vue-05filter多余吗.md\":\"02057bf4\",\"vue_重学vue-06computer.md\":\"10c8a4d4\",\"vue_重学vue-07watch.md\":\"25d56e53\",\"vue_重学vue-08组件.md\":\"3d21f25c\",\"vue_重学vue-09生命周期.md\":\"786dacfb\",\"vue_重学vue-10ref是什么.md\":\"a29dd7e6\",\"vue_重学vue-11nexttick.md\":\"35043fa8\",\"vue_重学vue-8组件通信.md\":\"4845edc5\",\"vue_重学vue-vue.use.md\":\"cc4266d2\",\"vue_重学vue-动画内置组件.md\":\"04d4553c\",\"vue3_elementplus.md\":\"2f3aeef9\",\"vue3_入门.md\":\"33504c8d\",\"webcomponents_1. webcomponent介绍.md\":\"29a6407a\",\"webcomponents_2. customelements.md\":\"9e1088a3\",\"webpack_1.md\":\"7279a63f\",\"webpack__草稿.md\":\"39f16499\",\"webpack_实现一个自己的脚手架.md\":\"b4d5365f\",\"webpack_重学webpack-01打包工具的思考.md\":\"083571d8\",\"webpack_重学webpack-02模块化原理.md\":\"0650e76f\",\"webpack_重学webpack-03loader.md\":\"43789662\",\"webpack_重学webpack-04plugin.md\":\"73454000\",\"webpack_重学webpack-05hmr热更新.md\":\"007085b5\",\"week_202110-1.md\":\"ecb6af64\",\"week_202110-2.md\":\"59fce584\",\"week_202111-1.md\":\"7d3ac50a\",\"week__0todo.md\":\"d60b5fc0\",\"week_缓存工具方法思路.md\":\"13a83606\",\"work_ios小白条问题.md\":\"cf9e950f\"}")</script>
    <script type="module" async src="/assets/app.d95e124d.js"></script>
    
  </body>
</html>